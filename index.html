<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVA TOOL</title>
    <style>
        :root {
            --bg-color: #0d0d15;
            --card-bg: #1a1a2e;
            --text-color: #f0f0f5;
            --primary: #00d4ff;
            --danger: #ff0055;
            --border: #2e2e4a;
            --success: #00ff88;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            padding: 20px;
            margin: 0;
        }

        .container {
            width: 100%;
            max-width: 500px;
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 0 25px rgba(0, 212, 255, 0.15);
            border: 1px solid var(--border);
        }

        header { text-align: center; margin-bottom: 25px; }
        .brand-title { margin: 0; font-size: 28px; font-weight: 900; letter-spacing: 3px; color: var(--primary); text-shadow: 0 0 10px rgba(0, 212, 255, 0.4); }
        .subtitle { font-size: 11px; text-transform: uppercase; opacity: 0.6; }

        .section { margin-bottom: 15px; }
        label { display: block; font-size: 12px; margin-bottom: 5px; color: var(--primary); font-weight: bold; }

        textarea, input {
            width: 100%; padding: 10px; background: #0a0a1a; border: 1px solid var(--border);
            border-radius: 8px; color: white; box-sizing: border-box; outline: none; font-family: 'Consolas', monospace;
        }
        
        textarea { height: 100px; resize: none; font-size: 11px; }

        .masked { -webkit-text-security: disc !important; }
        .view-toggle { font-size: 11px; color: var(--primary); cursor: pointer; text-align: right; margin-top: 5px; text-decoration: underline; user-select: none; }

        .form-row { display: flex; gap: 10px; }
        .form-row div { flex: 1; }

        .controls { display: flex; gap: 10px; margin-top: 20px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-primary:hover { opacity: 0.8; box-shadow: 0 0 15px var(--primary); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:disabled { background: #333; opacity: 0.5; cursor: not-allowed; }

        /* ログエリア */
        .status-board {
            margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3);
            border-radius: 8px; font-family: 'Consolas', monospace; font-size: 12px; border: 1px inset var(--border);
            height: 150px; overflow-y: auto; line-height: 1.4;
        }
        .status-summary {
            margin-top: 10px; display: flex; justify-content: space-between; font-size: 14px;
            color: var(--primary); font-family: 'Consolas', monospace;
        }

        .log-entry { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2px; }
        .log-success { color: var(--success); }
        .log-error { color: var(--danger); }
        .log-info { color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 class="brand-title">NOVA TOOL</h1>
        <div class="subtitle">Advanced Discord Auto-Onboarding</div>
    </header>

    <div class="section">
        <label>DISCORD TOKENS (1行に1つ入力)</label>
        <textarea id="tokens" class="masked" placeholder="token1&#10;token2&#10;token3"></textarea>
        <div class="view-toggle" id="toggleView">MASK ON/OFF</div>
    </div>

    <div class="form-row">
        <div class="section">
            <label>SERVER ID</label>
            <input type="text" id="serverId" placeholder="1234567890">
        </div>
        <div class="section">
            <label>TARGET MESSAGE ID</label>
            <input type="text" id="messageId" placeholder="9876543210">
        </div>
    </div>

    <div class="section">
        <label>CHANNEL ID</label>
        <input type="text" id="channelId" placeholder="555666777">
    </div>

    <div class="status-board" id="logArea">
        <div class="log-info">> システム待機中...</div>
    </div>
    
    <div class="status-summary">
        <span>PROGRESS: <span id="progressText">0%</span></span>
        <span>SUCCESS: <span id="successCount">0</span></span>
    </div>

    <div class="controls">
        <button class="btn btn-danger" id="stopBtn" disabled>STOP</button>
        <button class="btn btn-primary" id="startBtn">EXECUTE</button>
    </div>
</div>

<script>
    const tokensInput = document.getElementById('tokens');
    const toggleView = document.getElementById('toggleView');
    const logArea = document.getElementById('logArea');
    const startBtn = document.getElementById('startBtn');
    const progressText = document.getElementById('progressText');
    const successCountElem = document.getElementById('successCount');

    let isRunning = false;

    // トークンの表示切り替え
    toggleView.onclick = () => {
        tokensInput.classList.toggle('masked');
    };

    function addLog(msg, type = 'info') {
        const div = document.createElement('div');
        div.className = `log-entry log-${type}`;
        div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
        logArea.appendChild(div);
        logArea.scrollTop = logArea.scrollHeight;
    }

    async function executeAction(token, channelId, messageId, serverId) {
        try {
            // リアクション送信 (✅)
            const emoji = encodeURIComponent("✅");
            const res = await fetch(`https://discord.com/api/v9/channels/${channelId}/messages/${messageId}/reactions/${emoji}/@me`, {
                method: "PUT",
                headers: { "Authorization": token }
            });

            if (res.status === 204) {
                return true;
            } else {
                console.error(`Error: ${res.status}`);
                return false;
            }
        } catch (e) {
            return false;
        }
    }

    startBtn.onclick = async () => {
        const tokens = tokensInput.value.split('\n').map(t => t.trim()).filter(t => t !== "");
        const sId = document.getElementById('serverId').value.trim();
        const cId = document.getElementById('channelId').value.trim();
        const mId = document.getElementById('messageId').value.trim();

        if (tokens.length === 0 || !sId || !cId || !mId) {
            alert("全てのフィールドを入力してください");
            return;
        }

        isRunning = true;
        startBtn.disabled = true;
        document.getElementById('stopBtn').disabled = false;
        logArea.innerHTML = "";
        let successTotal = 0;

        addLog(`${tokens.length}個のトークンで処理を開始します...`, 'info');

        for (let i = 0; i < tokens.length; i++) {
            if (!isRunning) break;

            const token = tokens[i];
            const maskedToken = token.substring(0, 10) + "****";
            addLog(`処理中: ${maskedToken}...`);

            const success = await executeAction(token, cId, mId, sId);

            if (success) {
                successTotal++;
                successCountElem.textContent = successTotal;
                addLog(`成功: ${maskedToken}`, 'success');
            } else {
                addLog(`失敗: ${maskedToken}`, 'error');
            }

            // 進捗更新
            progressText.textContent = Math.round(((i + 1) / tokens.length) * 100) + "%";
            
            // API制限(Rate Limit)を考慮した待機 (1秒)
            await new Promise(r => setTimeout(r, 1000));
        }

        addLog("全工程が終了しました。", 'info');
        isRunning = false;
        startBtn.disabled = false;
        document.getElementById('stopBtn').disabled = true;
    };

    document.getElementById('stopBtn').onclick = () => {
        isRunning = false;
        addLog("停止リクエストを送信しました...", 'error');
    };
</script>
</body>
</html>
