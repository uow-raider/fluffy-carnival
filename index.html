<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Discord Tool - Advanced Debugger</title>
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <style>
        * { box-sizing: border-box; font-family: "Segoe UI", sans-serif; }
        body { margin: 0; height: 100vh; background: #0f172a; display: flex; align-items: center; justify-content: center; color: white; }
        .app { background: #1e293b; padding: 35px; border-radius: 12px; width: 450px; border: 1px solid #334155; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        .input-box { margin: 15px 0; }
        input { width: 100%; padding: 12px; border-radius: 6px; border: 1px solid #334155; background: #0f172a; color: white; outline: none; }
        .submit-btn { width: 100%; padding: 14px; background: #5865F2; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .submit-btn:hover { background: #4752c4; }
        
        /* エラーログ詳細表示 */
        #debug-log { display: none; margin-top: 15px; padding: 12px; background: #450a0a; border: 1px solid #991b1b; border-radius: 6px; font-size: 11px; color: #fca5a5; white-space: pre-wrap; }
        
        /* トークン情報エリア */
        #result-area { display: none; margin-top: 20px; padding: 20px; background: #064e3b; border: 1px solid #059669; border-radius: 8px; }
        .token-val { font-family: monospace; font-size: 11px; color: #34d399; word-break: break-all; background: #022c22; padding: 8px; border-radius: 4px; margin-top: 5px; }
        .status-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 10px; font-weight: bold; margin-bottom: 10px; }
        .valid { background: #10b981; color: white; }
        .invalid { background: #ef4444; color: white; }

        #captcha-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center; }
        .modal-body { background: #1e293b; padding: 25px; border-radius: 12px; text-align: center; border: 1px solid #334155; }
    </style>
</head>
<body>

<div class="app">
    <h2 style="text-align:center; margin:0 0 20px 0;">Account Generator v3</h2>
    
    <div id="main-form">
        <div class="input-box">
            <input type="email" id="email" placeholder="email@example.com">
        </div>
        <button id="next-btn" class="submit-btn" onclick="handleStart()">Next</button>
        <div id="debug-log"></div>
    </div>

    <div id="result-area">
        <div id="token-status-badge" class="status-badge">CHECKING...</div>
        <div style="font-size: 12px;">TOKEN:</div>
        <div id="token-val" class="token-val"></div>
        <div id="user-info" style="font-size: 11px; margin-top: 10px; color: #a7f3d0;"></div>
        <button class="submit-btn" style="background:#334155; margin-top:15px;" onclick="location.reload()">Create Another</button>
    </div>
</div>

<div id="captcha-modal">
    <div class="modal-body">
        <h3 style="margin-top:0;">Solve Captcha</h3>
        <div id="h-captcha-box"></div>
    </div>
</div>

<script>
    const CONFIG = {
        API: 'https://discord-api.soyaaaaana.com/register',
        DOB: "2000-03-27",
        SITEKEY: '4c672d3d-ef30-4fa0-a30a-2e11ec54518c'
    };

    let sessionData = {};

    function logError(err, context = "") {
        const logEl = document.getElementById('debug-log');
        logEl.style.display = "block";
        logEl.innerText = `[ERROR] ${context}\nMessage: ${err.message}\nTime: ${new Date().toLocaleTimeString()}\nPossible Cause: CORS, Rate Limit, or Server Down.`;
        console.error(err);
    }

    async function handleStart() {
        const email = document.getElementById('email').value;
        if(!email) return alert("Emailを入力してください");

        sessionData = {
            email: email,
            username: Math.random().toString(36).substring(2, 12) + Math.random().toString(36).substring(2, 12),
            password: Math.random().toString(36).substring(2, 15) + "!",
            date_of_birth: CONFIG.DOB
        };

        document.getElementById('next-btn').disabled = true;
        document.getElementById('debug-log').style.display = "none";
        
        await requestRegister(null);
    }

    async function requestRegister(captchaKey) {
        try {
            const res = await fetch(CONFIG.API, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ ...sessionData, captcha_key: captchaKey })
            });

            const data = await res.json();

            if (res.status === 400 || data.captcha_key || data.message === "captcha-required") {
                showCaptcha();
            } else if (data.token) {
                checkTokenValidity(data.token);
            } else {
                throw new Error(`Server returned ${res.status}: ${JSON.stringify(data)}`);
            }
        } catch (err) {
            logError(err, "Registration Fetch Failed");
            document.getElementById('next-btn').disabled = false;
        }
    }

    function showCaptcha() {
        document.getElementById('captcha-modal').style.display = 'flex';
        if (!window.hRendered) {
            hcaptcha.render('h-captcha-box', {
                sitekey: CONFIG.SITEKEY,
                callback: (token) => {
                    document.getElementById('captcha-modal').style.display = 'none';
                    requestRegister(token);
                },
                "error-callback": (e) => logError({message: "hCaptcha failed to load"}, "Captcha Interface")
            });
            window.hRendered = true;
        } else {
            hcaptcha.reset();
        }
    }

    // トークンの有効性チェック機能
    async function checkTokenValidity(token) {
        document.getElementById('main-form').style.display = 'none';
        document.getElementById('result-area').style.display = 'block';
        document.getElementById('token-val').innerText = token;

        try {
            // Discord APIへ直接問い合わせて有効性を確認
            const res = await fetch('https://discord.com/api/v9/users/@me', {
                headers: { 'Authorization': token }
            });

            const badge = document.getElementById('token-status-badge');
            const info = document.getElementById('user-info');

            if (res.ok) {
                const userData = await res.json();
                badge.innerText = "VALID TOKEN";
                badge.className = "status-badge valid";
                info.innerText = `User: ${userData.username}#${userData.discriminator}\nID: ${userData.id}\nVerified: ${userData.verified}`;
            } else {
                badge.innerText = "INVALID / LOCKED";
                badge.className = "status-badge invalid";
                info.innerText = "このトークンは無効であるか、電話認証が必要です。";
            }
        } catch (err) {
            logError(err, "Token Validation Check");
        }
    }
</script>
</body>
</html>
